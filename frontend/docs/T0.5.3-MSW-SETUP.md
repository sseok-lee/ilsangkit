# T0.5.3 - 프론트엔드 Mock 설정 완료

## 작업 개요

프론트엔드 독립 개발을 위한 MSW(Mock Service Worker) 설정을 완료했습니다.

## 생성된 파일

### Mock 관련 파일

| 파일 | 설명 |
|------|------|
| `mocks/browser.ts` | MSW 브라우저 워커 설정 |
| `mocks/data/facilities.ts` | Mock 데이터 정의 (카테고리, 시설, 지역) |
| `mocks/handlers/facilities.ts` | API 핸들러 정의 (8개 엔드포인트) |
| `mocks/README.md` | MSW 사용 가이드 |
| `plugins/msw.client.ts` | Nuxt 플러그인 (자동 활성화) |
| `public/mockServiceWorker.js` | 서비스 워커 스크립트 (MSW 생성) |
| `tests/mocks/handlers.test.ts` | MSW 핸들러 테스트 (14개 테스트) |

### 수정된 파일

| 파일 | 변경 내용 |
|------|----------|
| `package.json` | MSW 2.12.7 추가, workerDirectory 설정 |
| `eslint.config.mjs` | `public/` 디렉토리 제외, MSW 플러그인 콘솔 허용 |

## 지원하는 API 엔드포인트

### 메타데이터 (3개)

1. `GET /api/health` - 헬스체크
2. `GET /api/meta/categories` - 카테고리 목록 (6개 카테고리)
3. `GET /api/meta/regions` - 지역 목록 (5개 지역)

### 시설 검색 (5개)

4. `POST /api/facilities/search` - 시설 검색 (필터: category, lat/lng, radius, 페이지네이션)
5. `GET /api/facilities/:category/:id` - 시설 상세 (상세 정보 포함)
6. `GET /api/facilities/region/:city/:district/:category` - 지역별 조회
7. `GET /api/facilities/popular` - 인기 시설 목록
8. `GET /api/facilities/stats` - 시설 통계

## Mock 데이터

### 카테고리 (6개)

- 공공화장실 (toilet)
- 쓰레기 배출 (trash)
- 무료 와이파이 (wifi)
- 의류수거함 (clothes)
- 폐형광등/폐건전지 (battery)
- 무인민원발급기 (kiosk)

### 시설 (10개)

- 화장실 3개 (강남역, 신논현역, 역삼역)
- 쓰레기 배출 2개
- 무료 와이파이 2개
- 의류수거함 1개
- 폐건전지 수거함 1개
- 무인민원발급기 1개

### 지역 (5개)

- 서울 강남구, 서초구, 동작구, 관악구, 마포구

## 사용 방법

### 자동 활성화 (개발 모드)

```bash
npm run dev
# [MSW] Mock Service Worker started
# [MSW] API Base: http://localhost:8000
```

### 비활성화

```bash
# 환경 변수로 비활성화
NUXT_PUBLIC_DISABLE_MSW=true npm run dev

# 또는 .env 파일에 추가
echo "NUXT_PUBLIC_DISABLE_MSW=true" >> .env
```

### API 호출 예시

```typescript
// 컴포넌트에서 사용
const config = useRuntimeConfig();
const apiBase = config.public.apiBase;

// 카테고리 목록 조회
const { data } = await useFetch(`${apiBase}/api/meta/categories`);

// 시설 검색
const { data } = await useFetch(`${apiBase}/api/facilities/search`, {
  method: 'POST',
  body: {
    category: 'toilet',
    lat: 37.4979,
    lng: 127.0276,
    radius: 500,
    page: 1,
    limit: 20,
  },
});

// 시설 상세
const { data } = await useFetch(`${apiBase}/api/facilities/toilet/toilet-1`);
```

## 테스트 결과

### 전체 테스트 통과 ✅

```bash
npm test

 ✓ tests/example.test.ts (2 tests)
 ✓ tests/mocks/handlers.test.ts (14 tests)

 Test Files  2 passed (2)
      Tests  16 passed (16)
```

### 테스트 커버리지

| 항목 | 커버된 테스트 |
|------|-------------|
| 헬스체크 | ✅ |
| 카테고리 목록 | ✅ |
| 지역 목록 | ✅ |
| 시설 검색 (필터 없음) | ✅ |
| 시설 검색 (카테고리 필터) | ✅ |
| 시설 검색 (페이지네이션) | ✅ |
| 시설 검색 (위치 + 반경) | ✅ |
| 시설 상세 (성공) | ✅ |
| 시설 상세 (404) | ✅ |
| 시설 상세 (잘못된 카테고리) | ✅ |
| 지역별 조회 | ✅ |
| 인기 시설 목록 | ✅ |
| 인기 시설 (카테고리 필터) | ✅ |
| 시설 통계 | ✅ |

### 빌드 테스트 통과 ✅

```bash
npm run build
✔ Client built in 1010ms
✔ Server built in 470ms
[nitro] ✔ Nuxt Nitro server built
```

프로덕션 빌드에서 MSW 코드가 제외되는 것을 확인했습니다.

## 완료 조건 체크

- [x] 개발 환경에서 MSW 자동 활성화
- [x] Mock API 호출 시 데이터 반환 확인
- [x] `NUXT_PUBLIC_DISABLE_MSW=true`로 비활성화 가능
- [x] 모든 테스트 통과 (14개)
- [x] 프로덕션 빌드 성공
- [x] 사용 가이드 문서 작성

## 참고 사항

### 디버깅

- 브라우저 개발자 도구 → Network 탭에서 `[MSW]` 표시 확인
- 콘솔에서 `[MSW] Mock Service Worker started` 메시지 확인

### 커스터마이징

- Mock 데이터 추가: `mocks/data/facilities.ts` 수정
- 새 핸들러 추가: `mocks/handlers/` 디렉토리에 파일 추가 후 `mocks/browser.ts`에 등록

### 문서

상세 가이드는 `mocks/README.md` 참조

## 다음 단계

1. 프론트엔드 개발자가 백엔드 없이 UI 컴포넌트 개발 가능
2. 백엔드 API가 준비되면 `NUXT_PUBLIC_DISABLE_MSW=true` 설정으로 실제 API 사용
3. E2E 테스트에서 MSW 활용 가능

## 관련 태스크

- **이전**: T0.5.2 - 백엔드 Mock 설정
- **다음**: Phase 1 - 실제 기능 구현
