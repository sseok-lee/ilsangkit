// @TASK T0.4 - Prisma 스키마 정의
// @SPEC docs/planning/04-database-design.md

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum SyncStatus {
  running
  success
  failed
}

// @TASK T0.4 - 공공화장실 테이블
model Toilet {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 화장실 전용 필드
  operatingHours    String?  @db.VarChar(200)
  maleToilets       Int      @default(0)
  maleUrinals       Int      @default(0)
  femaleToilets     Int      @default(0)
  hasDisabledToilet Boolean  @default(false)
  openTime          String?  @db.VarChar(100)
  managingOrg       String?  @db.VarChar(200)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 무료와이파이 테이블
model Wifi {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 와이파이 전용 필드
  ssid             String?  @db.VarChar(100)
  installDate      String?  @db.VarChar(50)
  serviceProvider  String?  @db.VarChar(100)
  installLocation  String?  @db.VarChar(200)
  managementAgency String?  @db.VarChar(200)
  phoneNumber      String?  @db.VarChar(50)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 의류수거함 테이블
model Clothes {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 의류수거함 전용 필드
  managementAgency String?  @db.VarChar(200)
  phoneNumber      String?  @db.VarChar(50)
  dataDate         String?  @db.VarChar(50)
  detailLocation   String?  @db.VarChar(500)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 무인민원발급기 테이블
model Kiosk {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 무인민원발급기 전용 필드
  detailLocation         String?  @db.VarChar(500)
  operationAgency        String?  @db.VarChar(200)
  weekdayOperatingHours  String?  @db.VarChar(100)
  saturdayOperatingHours String?  @db.VarChar(100)
  holidayOperatingHours  String?  @db.VarChar(100)
  blindKeypad            Boolean  @default(false)
  voiceGuide             Boolean  @default(false)
  brailleOutput          Boolean  @default(false)
  wheelchairAccessible   Boolean  @default(false)
  mngNo                  String?  @db.VarChar(50)  // 관리번호 (API 연결키)
  availableDocuments     Json?                     // 발급 가능 민원 목록

  @@index([city, district])
  @@index([lat, lng])
  @@index([mngNo])
}

// @TASK T9.1.1 - 공영주차장 테이블
model Parking {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 주차장 전용 필드
  parkingType      String?  @db.VarChar(50)   // 주차구분 (공영/민영)
  lotType          String?  @db.VarChar(50)   // 주차장유형 (노외/노상/부설)
  capacity         Int      @default(0)       // 주차면수
  baseFee          Int?                       // 기본요금 (원)
  baseTime         Int?                       // 기본시간 (분)
  additionalFee    Int?                       // 추가요금 (원)
  additionalTime   Int?                       // 추가시간 (분)
  dailyMaxFee      Int?                       // 일최대요금 (원)
  monthlyFee       Int?                       // 월정기권요금 (원)
  operatingHours   String?  @db.VarChar(200)  // 운영시간
  phone            String?  @db.VarChar(50)   // 전화번호
  paymentMethod    String?  @db.VarChar(200)  // 결제방법
  remarks          String?  @db.Text          // 특기사항
  hasDisabledParking Boolean @default(false)  // 장애인전용주차구역보유여부

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 카테고리 마스터 테이블
// @SPEC docs/planning/04-database-design.md#category-table
model Category {
  id          String  @id @db.VarChar(20)
  name        String  @db.VarChar(50)
  icon        String  @db.VarChar(10)
  description String? @db.VarChar(200)
  sortOrder   Int     @default(0)
  isActive    Boolean @default(true)
}

// @TASK T0.4 - 지역 마스터 테이블
// @SPEC docs/planning/04-database-design.md#region-table
model Region {
  id       Int     @id @default(autoincrement())
  bjdCode  String  @db.VarChar(5)
  city     String  @db.VarChar(50)
  district String  @db.VarChar(50)
  slug     String  @db.VarChar(50)
  lat      Decimal @db.Decimal(10, 7)
  lng      Decimal @db.Decimal(10, 7)

  @@unique([bjdCode])
  @@unique([city, district])
  @@unique([city, slug])
}

// @TASK T0.4 - 검색 로그 테이블
// @SPEC docs/planning/04-database-design.md#search-log-table
model SearchLog {
  id          Int      @id @default(autoincrement())
  sessionId   String   @db.VarChar(32)
  keyword     String?  @db.VarChar(200)
  category    String?  @db.VarChar(20)
  city        String?  @db.VarChar(50)
  district    String?  @db.VarChar(50)
  lat         Decimal? @db.Decimal(10, 7)
  lng         Decimal? @db.Decimal(10, 7)
  resultCount Int      @default(0)
  createdAt   DateTime @default(now())

  @@index([createdAt])
  @@index([keyword])
}

// @TASK T0.4 - 동기화 히스토리 테이블
// @SPEC docs/planning/04-database-design.md#sync-history-table
model SyncHistory {
  id             Int        @id @default(autoincrement())
  category       String     @db.VarChar(20)
  status         SyncStatus
  totalRecords   Int        @default(0)
  newRecords     Int        @default(0)
  updatedRecords Int        @default(0)
  errorMessage   String?    @db.Text
  startedAt      DateTime   @default(now())
  completedAt    DateTime?
}

// 쓰레기 배출 일정 테이블 (좌표 없음 - 지도 마커 X)
// API: https://www.data.go.kr/data/15155080/openapi.do
model WasteSchedule {
  id            Int      @id @default(autoincrement())
  city          String   @db.VarChar(50)  // 시도명 (CTPV_NM)
  district      String   @db.VarChar(50)  // 시군구명 (SGG_NM)
  targetRegion  String?  @db.Text // 관리구역대상지역명 (MNG_ZONE_TRGT_RGN_NM)
  emissionPlace String?  @db.VarChar(100) // 배출장소 (EMSN_PLC)
  details       Json?                     // 기타 상세 정보 (배출요일, 시간 등)
  sourceId      String   @db.VarChar(100) // 원본 데이터 ID
  sourceUrl     String?  @db.VarChar(500) // 데이터 출처
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  @@unique([city, district, sourceId])
  @@index([city, district])
}
