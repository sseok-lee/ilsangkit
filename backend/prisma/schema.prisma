// @TASK T0.4 - Prisma 스키마 정의
// @SPEC docs/planning/04-database-design.md

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum SyncStatus {
  running
  success
  failed
}

// @TASK T0.4 - 공공화장실 테이블
model Toilet {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 화장실 전용 필드
  operatingHours    String?  @db.VarChar(200)
  maleToilets       Int      @default(0)
  maleUrinals       Int      @default(0)
  femaleToilets     Int      @default(0)
  hasDisabledToilet Boolean  @default(false)
  openTime          String?  @db.VarChar(100)
  managingOrg       String?  @db.VarChar(200)

  // 추가 상세 필드
  phoneNumber              String?  @db.VarChar(50)
  installDate              String?  @db.VarChar(50)
  ownershipType            String?  @db.VarChar(50)
  sewageTreatment          String?  @db.VarChar(100)
  hasEmergencyBell         Boolean  @default(false)
  emergencyBellLocation    String?  @db.VarChar(200)
  hasCCTV                  Boolean  @default(false)
  hasDiaperChangingTable   Boolean  @default(false)
  diaperChangingLocation   String?  @db.VarChar(200)
  maleDisabledToilets      Int      @default(0)
  maleDisabledUrinals      Int      @default(0)
  maleChildToilets         Int      @default(0)
  maleChildUrinals         Int      @default(0)
  femaleDisabledToilets    Int      @default(0)
  femaleChildToilets       Int      @default(0)
  remodelingDate           String?  @db.VarChar(50)
  facilityType             String?  @db.VarChar(100)
  legalBasis               String?  @db.VarChar(200)
  govCode                  String?  @db.VarChar(20)
  dataDate                 String?  @db.VarChar(20)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 무료와이파이 테이블
model Wifi {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 와이파이 전용 필드
  ssid             String?  @db.VarChar(100)
  installDate      String?  @db.VarChar(50)
  serviceProvider  String?  @db.VarChar(100)
  installLocation  String?  @db.VarChar(200)
  managementAgency String?  @db.VarChar(200)
  phoneNumber      String?  @db.VarChar(50)

  // 추가 상세 필드
  installLocationDetail String?  @db.VarChar(500)
  govCode              String?  @db.VarChar(20)
  dataDate             String?  @db.VarChar(20)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 의류수거함 테이블
model Clothes {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 의류수거함 전용 필드
  managementAgency String?  @db.VarChar(200)
  phoneNumber      String?  @db.VarChar(50)
  dataDate         String?  @db.VarChar(50)
  detailLocation   String?  @db.VarChar(500)

  // 추가 상세 필드
  providerCode     String?  @db.VarChar(20)
  providerName     String?  @db.VarChar(200)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 무인민원발급기 테이블
model Kiosk {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 무인민원발급기 전용 필드
  detailLocation         String?  @db.VarChar(500)
  operationAgency        String?  @db.VarChar(200)
  weekdayOperatingHours  String?  @db.VarChar(100)
  saturdayOperatingHours String?  @db.VarChar(100)
  holidayOperatingHours  String?  @db.VarChar(100)
  blindKeypad            Boolean  @default(false)
  voiceGuide             Boolean  @default(false)
  brailleOutput          Boolean  @default(false)
  wheelchairAccessible   Boolean  @default(false)
  mngNo                  String?  @db.VarChar(50)  // 관리번호 (API 연결키)
  availableDocuments     Json?                     // 발급 가능 민원 목록

  // 추가 상세 필드
  govCode                String?  @db.VarChar(20)
  installPosition        String?  @db.VarChar(200)
  dataDate               String?  @db.VarChar(20)

  @@index([city, district])
  @@index([lat, lng])
  @@index([mngNo])
}

// @TASK T9.1.1 - 공영주차장 테이블
model Parking {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 주차장 전용 필드
  parkingType      String?  @db.VarChar(50)   // 주차구분 (공영/민영)
  lotType          String?  @db.VarChar(50)   // 주차장유형 (노외/노상/부설)
  capacity         Int      @default(0)       // 주차면수
  baseFee          Int?                       // 기본요금 (원)
  baseTime         Int?                       // 기본시간 (분)
  additionalFee    Int?                       // 추가요금 (원)
  additionalTime   Int?                       // 추가시간 (분)
  dailyMaxFee      Int?                       // 일최대요금 (원)
  monthlyFee       Int?                       // 월정기권요금 (원)
  operatingHours   String?  @db.VarChar(200)  // 운영시간
  phone            String?  @db.VarChar(50)   // 전화번호
  paymentMethod    String?  @db.VarChar(200)  // 결제방법
  remarks          String?  @db.Text          // 특기사항
  hasDisabledParking Boolean @default(false)  // 장애인전용주차구역보유여부

  // 추가 상세 필드
  zoneClass        String?  @db.VarChar(50)
  alternateParking String?  @db.VarChar(50)
  operatingDays    String?  @db.VarChar(100)
  feeType          String?  @db.VarChar(50)
  dailyMaxFeeHours String?  @db.VarChar(50)
  managingOrg      String?  @db.VarChar(200)
  dataDate         String?  @db.VarChar(20)
  providerCode     String?  @db.VarChar(20)
  providerName     String?  @db.VarChar(200)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T9.2 - 자동심장충격기(AED) 테이블
model Aed {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // AED 전용 필드
  buildPlace    String?  @db.VarChar(500)   // 설치 상세위치
  org           String?  @db.VarChar(200)   // 설치기관
  clerkTel      String?  @db.VarChar(50)    // 담당자 전화
  mfg           String?  @db.VarChar(100)   // 제조사
  model         String?  @db.VarChar(100)   // 모델명
  monSttTme     String?  @db.VarChar(4)     // 월요일 시작
  monEndTme     String?  @db.VarChar(4)     // 월요일 종료
  tueSttTme     String?  @db.VarChar(4)
  tueEndTme     String?  @db.VarChar(4)
  wedSttTme     String?  @db.VarChar(4)
  wedEndTme     String?  @db.VarChar(4)
  thuSttTme     String?  @db.VarChar(4)
  thuEndTme     String?  @db.VarChar(4)
  friSttTme     String?  @db.VarChar(4)
  friEndTme     String?  @db.VarChar(4)
  satSttTme     String?  @db.VarChar(4)
  satEndTme     String?  @db.VarChar(4)
  sunSttTme     String?  @db.VarChar(4)
  sunEndTme     String?  @db.VarChar(4)
  holSttTme     String?  @db.VarChar(4)     // 공휴일 시작
  holEndTme     String?  @db.VarChar(4)     // 공휴일 종료
  dataDate      String?  @db.VarChar(20)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T9.3 - 공공도서관 테이블
model Library {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 도서관 전용 필드
  libraryType       String?  @db.VarChar(50)
  closedDays        String?  @db.VarChar(200)
  weekdayOpenTime   String?  @db.VarChar(10)
  weekdayCloseTime  String?  @db.VarChar(10)
  saturdayOpenTime  String?  @db.VarChar(10)
  saturdayCloseTime String?  @db.VarChar(10)
  holidayOpenTime   String?  @db.VarChar(10)
  holidayCloseTime  String?  @db.VarChar(10)
  seatCount         Int      @default(0)
  bookCount         Int      @default(0)
  serialCount       Int      @default(0)       // 자료수(연속간행물)
  nonBookCount      Int      @default(0)       // 자료수(비도서)
  loanableBooks     Int      @default(0)       // 대출가능권수
  loanableDays      Int      @default(0)       // 대출가능일수
  phoneNumber       String?  @db.VarChar(50)
  homepageUrl       String?  @db.VarChar(500)
  operatingOrg      String?  @db.VarChar(200)

  // 추가 상세 필드
  lotArea           String?  @db.VarChar(50)
  buildingArea      String?  @db.VarChar(50)
  dataDate          String?  @db.VarChar(20)
  providerCode      String?  @db.VarChar(20)
  providerName      String?  @db.VarChar(200)

  @@index([city, district])
  @@index([lat, lng])
}

// @TASK T0.4 - 카테고리 마스터 테이블
// @SPEC docs/planning/04-database-design.md#category-table
model Category {
  id          String  @id @db.VarChar(20)
  name        String  @db.VarChar(50)
  icon        String  @db.VarChar(10)
  description String? @db.VarChar(200)
  sortOrder   Int     @default(0)
  isActive    Boolean @default(true)
}

// @TASK T0.4 - 지역 마스터 테이블
// @SPEC docs/planning/04-database-design.md#region-table
model Region {
  id       Int     @id @default(autoincrement())
  bjdCode  String  @db.VarChar(5)
  city     String  @db.VarChar(50)
  district String  @db.VarChar(50)
  slug     String  @db.VarChar(50)
  lat      Decimal @db.Decimal(10, 7)
  lng      Decimal @db.Decimal(10, 7)

  @@unique([bjdCode])
  @@unique([city, district])
  @@unique([city, slug])
}

// @TASK T0.4 - 검색 로그 테이블
// @SPEC docs/planning/04-database-design.md#search-log-table
model SearchLog {
  id          Int      @id @default(autoincrement())
  sessionId   String   @db.VarChar(32)
  keyword     String?  @db.VarChar(200)
  category    String?  @db.VarChar(20)
  city        String?  @db.VarChar(50)
  district    String?  @db.VarChar(50)
  lat         Decimal? @db.Decimal(10, 7)
  lng         Decimal? @db.Decimal(10, 7)
  resultCount Int      @default(0)
  createdAt   DateTime @default(now())

  @@index([createdAt])
  @@index([keyword])
}

// @TASK T0.4 - 동기화 히스토리 테이블
// @SPEC docs/planning/04-database-design.md#sync-history-table
model SyncHistory {
  id             Int        @id @default(autoincrement())
  category       String     @db.VarChar(20)
  status         SyncStatus
  totalRecords   Int        @default(0)
  newRecords     Int        @default(0)
  updatedRecords Int        @default(0)
  errorMessage   String?    @db.Text
  startedAt      DateTime   @default(now())
  completedAt    DateTime?
}

// 쓰레기 배출 일정 테이블 (좌표 없음 - 지도 마커 X)
// API: https://www.data.go.kr/data/15155080/openapi.do
model WasteSchedule {
  id            Int      @id @default(autoincrement())
  city          String   @db.VarChar(50)  // 시도명 (CTPV_NM)
  district      String   @db.VarChar(50)  // 시군구명 (SGG_NM)
  targetRegion  String?  @db.Text // 관리구역대상지역명 (MNG_ZONE_TRGT_RGN_NM)
  emissionPlace String?  @db.VarChar(100) // 배출장소 (EMSN_PLC)
  details       Json?                     // 기타 상세 정보 (배출요일, 시간 등)
  sourceId      String   @db.VarChar(100) // 원본 데이터 ID
  sourceUrl     String?  @db.VarChar(500) // 데이터 출처
  govCode       String?  @db.VarChar(20)  // 개방자치단체코드
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  @@unique([city, district, sourceId])
  @@index([city, district])
}

// 병원 테이블
model Hospital {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 병원 전용 필드
  phone          String?  @db.VarChar(50)
  homepage       String?  @db.VarChar(500)
  postNo         String?  @db.VarChar(20)
  estbDd         String?  @db.VarChar(20)
  ykiho          String?  @db.VarChar(100)
  clCd           String?  @db.VarChar(20)
  clCdNm         String?  @db.VarChar(100)
  sidoCd         String?  @db.VarChar(20)
  sgguCd         String?  @db.VarChar(20)
  emdongNm       String?  @db.VarChar(100)
  drTotCnt       Int?
  mdeptSdrCnt    Int?
  mdeptGdrCnt    Int?
  mdeptIntnCnt   Int?
  mdeptResdntCnt Int?
  detySdrCnt     Int?
  detyGdrCnt     Int?
  detyIntnCnt    Int?
  detyResdntCnt  Int?
  cmdcSdrCnt     Int?
  cmdcGdrCnt     Int?
  cmdcIntnCnt    Int?
  cmdcResdntCnt  Int?
  pnursCnt       Int?
  dataDate       String?  @db.VarChar(20)

  @@index([city, district])
  @@index([lat, lng])
}

// 약국 테이블
model Pharmacy {
  id            String   @id @db.VarChar(50)
  name          String   @db.VarChar(200)
  address       String?  @db.VarChar(500)
  roadAddress   String?  @db.VarChar(500)
  lat           Decimal? @db.Decimal(10, 7)
  lng           Decimal? @db.Decimal(10, 7)
  city          String   @db.VarChar(50)
  district      String   @db.VarChar(50)
  bjdCode       String?  @db.VarChar(5)
  sourceId      String   @unique @db.VarChar(100)
  sourceUrl     String?  @db.VarChar(500)
  viewCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  syncedAt      DateTime @default(now())

  // 약국 전용 필드
  phone         String?  @db.VarChar(50)
  dutyTel3      String?  @db.VarChar(50)
  hpid          String   @db.VarChar(100)
  postCdn1      String?  @db.VarChar(20)
  postCdn2      String?  @db.VarChar(20)
  dutyTime1s    String?  @db.VarChar(10)
  dutyTime1c    String?  @db.VarChar(10)
  dutyTime2s    String?  @db.VarChar(10)
  dutyTime2c    String?  @db.VarChar(10)
  dutyTime3s    String?  @db.VarChar(10)
  dutyTime3c    String?  @db.VarChar(10)
  dutyTime4s    String?  @db.VarChar(10)
  dutyTime4c    String?  @db.VarChar(10)
  dutyTime5s    String?  @db.VarChar(10)
  dutyTime5c    String?  @db.VarChar(10)
  dutyTime6s    String?  @db.VarChar(10)
  dutyTime6c    String?  @db.VarChar(10)
  dutyTime7s    String?  @db.VarChar(10)
  dutyTime7c    String?  @db.VarChar(10)
  dutyTime8s    String?  @db.VarChar(10)
  dutyTime8c    String?  @db.VarChar(10)
  dutyMapimg    String?  @db.Text
  dutyInf       String?  @db.Text
  dutyEtc       String?  @db.Text
  dataDate      String?  @db.VarChar(20)

  @@index([city, district])
  @@index([lat, lng])
  @@index([hpid])
}
