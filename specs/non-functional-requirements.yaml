version: "2.0"
date: "2026-02-12"
description: 비기능 요구사항 정의 - 성능, SEO, 접근성, 보안, 모니터링

performance:
  core_web_vitals:
    description: Google Core Web Vitals 목표치
    metrics:
      LCP:
        target: "< 2.5s"
        description: Largest Contentful Paint - 최대 콘텐츠풀 페인트
        measurement: 페이지 로드 시 가장 큰 요소 렌더링 시간
      FID:
        target: "< 100ms"
        description: First Input Delay - 최초 입력 지연
        measurement: 사용자 첫 상호작용부터 브라우저 응답까지 시간
      CLS:
        target: "< 0.1"
        description: Cumulative Layout Shift - 누적 레이아웃 이동
        measurement: 예상치 못한 레이아웃 변경 점수
      INP:
        target: "< 200ms"
        description: Interaction to Next Paint - 다음 페인트까지 상호작용 시간
        measurement: 모든 상호작용 응답 시간 (FID 대체 지표)
    validation:
      tool: Google Lighthouse
      target_score: "> 90"
      test_environment: production build

  api_response:
    description: 백엔드 API 응답 시간 목표
    metrics:
      p50:
        target: "< 200ms"
        description: 50번째 백분위수 (중앙값)
      p95:
        target: "< 500ms"
        description: 95번째 백분위수
      p99:
        target: "< 1000ms"
        description: 99번째 백분위수
    endpoints:
      - path: /api/facilities/search
        critical: true
        timeout: 5000ms
      - path: /api/facilities/:category/:id
        critical: true
        timeout: 3000ms
      - path: /api/meta/regions
        cacheable: true
        cache_ttl: 86400s
    optimization:
      - 인덱스 최적화: city, district, lat, lng 복합 인덱스
      - 쿼리 최적화: EXPLAIN ANALYZE 기반 튜닝
      - 연결 풀링: 최소 10, 최대 50 커넥션

  bundle_size:
    description: 번들 크기 제한 (gzipped)
    limits:
      js_gzipped: "< 200KB"
      css_gzipped: "< 50KB"
      total_transfer: "< 500KB"
    strategies:
      - 코드 스플리팅: 라우트 기반 lazy loading
      - 트리 쉐이킹: unused imports 제거
      - 동적 import: Kakao Maps, Chart.js 등
      - 폰트 최적화: variable font 사용 (Pretendard)
      - 이미지 최적화: WebP 포맷, lazy loading
    validation:
      - tool: webpack-bundle-analyzer
      - ci_check: true
      - fail_threshold: 250KB (js gzipped)

  rendering:
    description: 렌더링 전략
    ssr:
      enabled: true
      prerender_routes:
        - /
        - /about
        - /privacy
        - /terms
    caching:
      static_assets: "max-age=31536000, immutable"
      api_responses: "no-cache (실시간 데이터)"
      sitemap: "swr=86400 (24시간)"
      icons: "max-age=86400"

seo:
  lighthouse_score:
    target: "> 90"
    measurement: Google Lighthouse SEO 점수
    validation_frequency: 매 PR 빌드 시

  sitemap:
    description: XML 사이트맵 자동 생성
    strategy: 동적 생성 (백엔드 API 기반)
    split: true
    split_limit: 50000
    routes:
      - /sitemap.xml (인덱스)
      - /sitemap/cities.xml
      - /sitemap/districts/:city.xml
      - /sitemap/facilities/:category.xml
    update_frequency: daily
    priority_rules:
      - path: /
        priority: 1.0
        changefreq: daily
      - path: /:category/:id
        priority: 0.8
        changefreq: weekly
      - path: /city/:city
        priority: 0.7
        changefreq: weekly

  structured_data:
    description: JSON-LD 구조화 데이터
    schemas:
      - type: Organization
        location: 전체 페이지
        fields:
          - name
          - url
          - logo
          - sameAs (소셜 미디어)
      - type: BreadcrumbList
        location: 상세 페이지, 지역 페이지
        dynamic: true
      - type: LocalBusiness
        location: 시설 상세 페이지
        fields:
          - name
          - address
          - geo (latitude, longitude)
          - openingHours (해당 시)
          - telephone (해당 시)
    validation:
      tool: Google Rich Results Test
      frequency: 매 배포 후

  meta_tags:
    description: 동적 메타 태그 생성
    tags:
      title:
        pattern: "{시설명} - {카테고리} | 일상킷"
        max_length: 60
        fallback: "일상킷 - 내 주변 생활 편의 정보"
      description:
        pattern: "{지역} {카테고리} 정보. {주소}, 운영시간, 상세 정보 제공"
        max_length: 160
        fallback: "위치 기반으로 내 주변 공공시설과 생활 편의 정보를 통합 검색합니다"
      og:title:
        source: title
      og:description:
        source: description
      og:image:
        default: /images/og-image.png
        size: 1200x630
      og:type:
        value: website
      twitter:card:
        value: summary_large_image
    implementation: composables/useStructuredData.ts

  robots_txt:
    allow:
      - /
      - /api/health
    disallow:
      - /api/*
      - /_nuxt/*
    sitemap: https://ilsangkit.com/sitemap.xml

accessibility:
  wcag_level: AA
  description: 웹 콘텐츠 접근성 지침 2.1 Level AA 준수

  lighthouse_score:
    target: "> 85"
    measurement: Google Lighthouse Accessibility 점수

  keyboard_navigation:
    enabled: true
    requirements:
      - Tab 키로 모든 인터랙티브 요소 접근 가능
      - Enter/Space로 버튼/링크 활성화
      - Escape로 모달/드롭다운 닫기
      - 포커스 인디케이터 명확히 표시
    implementation:
      - tabindex 적절히 사용
      - focus-visible 스타일링
      - 키보드 이벤트 핸들러

  touch_target:
    min_size: 44x44px
    description: 터치 타겟 최소 크기 (Apple HIG, Material Design 준수)
    applies_to:
      - 버튼
      - 링크
      - 입력 필드
      - 체크박스/라디오

  color_contrast:
    ratio: ">= 4.5:1"
    description: 텍스트와 배경 색상 대비율 (WCAG AA 기준)
    exceptions:
      - 장식 요소
      - 비활성화된 요소
    validation:
      tool: axe DevTools
      ci_check: true

  aria:
    description: ARIA 속성 적절히 사용
    requirements:
      - 동적 콘텐츠에 aria-live 사용
      - 이미지에 적절한 alt 텍스트
      - 폼 입력에 aria-label 또는 label 연결
      - 랜드마크 role 사용 (navigation, main, complementary)
    implementation:
      - Vue 컴포넌트에 ARIA 속성 내장
      - 스크린 리더 테스트 (NVDA, VoiceOver)

  semantic_html:
    description: 의미론적 HTML 사용
    requirements:
      - header, nav, main, footer, article, section 적절히 사용
      - 제목 계층 (h1-h6) 순차적 사용
      - button vs a 태그 적절히 구분
      - form 요소 올바르게 구성

security:
  headers:
    description: 보안 HTTP 헤더 설정
    implementation: nuxt.config.ts nitro.routeRules
    headers:
      X-Content-Type-Options:
        value: nosniff
        description: MIME 타입 스니핑 방지
      X-Frame-Options:
        value: DENY
        description: 클릭재킹 공격 방지
      Referrer-Policy:
        value: strict-origin-when-cross-origin
        description: 리퍼러 정보 제한
      Content-Security-Policy:
        value: "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://dapi.kakao.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https://cdn.jsdelivr.net https://fonts.gstatic.com; connect-src 'self' https://dapi.kakao.com"
        description: XSS 공격 방지 (프로덕션 환경)
      Strict-Transport-Security:
        value: max-age=31536000; includeSubDomains
        description: HTTPS 강제 (프로덕션 환경)
        applies_to: production

  cors:
    description: CORS 정책 설정
    implementation: backend/src/middlewares/cors.ts
    rules:
      development:
        origin: http://localhost:3000
      production:
        origin: https://ilsangkit.com
      credentials: false
      methods: [GET, POST]
      allowed_headers: [Content-Type]

  rate_limiting:
    description: API 요청 속도 제한
    implementation: backend/src/middlewares/rateLimiter.ts
    limits:
      global:
        window: 60s
        max_requests: 100
        key: IP 주소
      search_api:
        window: 60s
        max_requests: 30
        key: IP 주소
    response:
      status: 429
      message: Too Many Requests
      retry_after: 60s

  input_validation:
    description: 사용자 입력 검증
    implementation: Zod 스키마 (backend/src/schemas/)
    validation_points:
      - API 요청 body (POST)
      - API 쿼리 파라미터 (GET)
      - 경로 파라미터
    sanitization:
      - XSS 방지: HTML 태그 이스케이프
      - SQL 인젝션 방지: Prisma ORM 파라미터화
      - 파일 업로드 제한: 현재 미지원

  environment_variables:
    description: 민감 정보 환경 변수 관리
    storage:
      - .env 파일 (gitignore에 포함)
      - 프로덕션: 서버 환경 변수
    sensitive_data:
      - DATABASE_URL
      - OPENAPI_SERVICE_KEY
      - NUXT_PUBLIC_KAKAO_MAP_KEY
      - NUXT_PUBLIC_GA_ID
    validation:
      - 하드코딩 검사: ESLint 규칙
      - 누락 검사: 애플리케이션 시작 시

monitoring:
  health_check:
    description: 서버 상태 확인 엔드포인트
    endpoint: /api/health
    method: GET
    response:
      healthy:
        status: 200
        body:
          status: ok
          timestamp: ISO 8601
          uptime: seconds
      unhealthy:
        status: 503
        body:
          status: error
          message: error description
    checks:
      - 데이터베이스 연결
      - 메모리 사용량 (< 80%)
      - 디스크 공간 (> 10% 여유)
    frequency: 매 30초 (모니터링 도구)

  error_tracking:
    description: 에러 추적 및 로깅
    implementation: Request ID 기반 추적
    log_levels:
      - error: 시스템 오류, 크래시
      - warn: 예상 가능한 문제
      - info: 일반 정보
      - debug: 디버깅 정보
    request_id:
      generation: UUID v4
      header: X-Request-ID
      propagation: 모든 로그에 포함
    retention:
      production: 30일
      development: 7일

  analytics:
    description: 사용자 행동 분석
    tool: Google Analytics 4
    implementation: NUXT_PUBLIC_GA_ID
    events:
      - page_view: 페이지 조회
      - facility_search: 시설 검색
      - facility_view: 시설 상세 조회
      - map_interaction: 지도 마커 클릭
    privacy:
      - IP 익명화: 활성화
      - 개인정보 수집: 최소화
      - 쿠키 동의: 필수 (추후 구현)

  uptime:
    target: "> 99.5%"
    measurement: 월별 가동 시간 비율
    excludes:
      - 계획된 유지보수 (사전 공지)
      - 외부 API 장애 (공공데이터 포털)

deployment:
  description: 배포 및 인프라 요구사항
  environment:
    server: Cafe24 가상서버 호스팅
    web_server: Nginx (리버스 프록시)
    process_manager: PM2
    database: MySQL 8.0+
  ci_cd:
    tool: GitHub Actions
    workflow:
      - lint: ESLint, Prettier
      - test: Vitest (backend, frontend)
      - build: TypeScript 컴파일, Nuxt build
      - deploy: rsync to production server
    triggers:
      - push to main branch
      - pull request (build only)
  rollback:
    strategy: PM2 이전 버전 재시작
    max_retention: 3개 버전

validation:
  description: 비기능 요구사항 검증 방법
  automated:
    - Lighthouse CI: 매 PR 빌드 시 Core Web Vitals, SEO, Accessibility 점수 검증
    - Bundle size check: webpack-bundle-analyzer, 250KB 초과 시 빌드 실패
    - API response time: 프로덕션 모니터링, p95 > 500ms 시 알림
    - Security headers: Cypress E2E 테스트에서 헤더 검증
  manual:
    - 스크린 리더 테스트: NVDA (Windows), VoiceOver (macOS)
    - 키보드 네비게이션 테스트: 전체 사용자 플로우
    - 색상 대비 검사: axe DevTools, Lighthouse
  reporting:
    frequency: 매 배포 후
    tools:
      - Google Lighthouse
      - WebPageTest
      - Google Search Console
