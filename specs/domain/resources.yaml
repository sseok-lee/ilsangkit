version: "2.0"
project: ilsangkit
generated: 2026-02-12

# Common facility fields template (DRY principle)
_commonFacilityFields: &commonFields
  id:
    type: string
    primaryKey: true
    maxLength: 50
    description: 고유 식별자 (해시 기반)
  name:
    type: string
    maxLength: 200
    required: true
    description: 시설명
  address:
    type: string
    maxLength: 500
    nullable: true
    description: 지번 주소
  roadAddress:
    type: string
    maxLength: 500
    nullable: true
    description: 도로명 주소
  lat:
    type: decimal
    precision: [10, 7]
    nullable: true
    description: 위도 (WGS84)
  lng:
    type: decimal
    precision: [10, 7]
    nullable: true
    description: 경도 (WGS84)
  city:
    type: string
    maxLength: 50
    required: true
    description: 시/도
  district:
    type: string
    maxLength: 50
    required: true
    description: 시/군/구
  bjdCode:
    type: string
    maxLength: 5
    nullable: true
    description: 법정동 코드
  sourceId:
    type: string
    maxLength: 100
    unique: true
    required: true
    description: 원본 데이터 고유키
  sourceUrl:
    type: string
    maxLength: 500
    nullable: true
    description: 데이터 출처 URL
  viewCount:
    type: int
    default: 0
    description: 조회수
  createdAt:
    type: datetime
    default: now()
    description: 생성일시
  updatedAt:
    type: datetime
    autoUpdate: true
    description: 수정일시
  syncedAt:
    type: datetime
    default: now()
    description: 동기화 일시

resources:
  toilet:
    name: 공공화장실
    table: Toilet
    source:
      dataNumber: "15012892"
      method: CSV
      provider: data.go.kr
      url: https://www.localdata.go.kr/datafile/each/07_24_05_P_CSV.zip
    fields:
      <<: *commonFields
      # Toilet-specific fields
      operatingHours:
        type: string
        maxLength: 200
        nullable: true
        description: 운영시간
      maleToilets:
        type: int
        default: 0
        description: 남성 화장실 수
      maleUrinals:
        type: int
        default: 0
        description: 남성 소변기 수
      femaleToilets:
        type: int
        default: 0
        description: 여성 화장실 수
      hasDisabledToilet:
        type: boolean
        default: false
        description: 장애인 화장실 유무
      openTime:
        type: string
        maxLength: 100
        nullable: true
        description: 개방시간
      managingOrg:
        type: string
        maxLength: 200
        nullable: true
        description: 관리기관명
    indexes:
      - fields: [city, district]
        type: composite
      - fields: [lat, lng]
        type: composite
    businessRules:
      - 좌표 범위: 위도 33-39, 경도 124-132 (한국 영역)
      - CSV 파일 인코딩: EUC-KR 또는 UTF-8 자동 감지

  wifi:
    name: 무료와이파이
    table: Wifi
    source:
      dataNumber: "15013116"
      method: CSV
      provider: data.go.kr
      url: https://www.localdata.go.kr/datafile/each/07_24_04_P_CSV.zip
    fields:
      <<: *commonFields
      # Wifi-specific fields
      ssid:
        type: string
        maxLength: 100
        nullable: true
        description: 와이파이 SSID
      installDate:
        type: string
        maxLength: 50
        nullable: true
        description: 설치연월
      serviceProvider:
        type: string
        maxLength: 100
        nullable: true
        description: 서비스 제공사
      installLocation:
        type: string
        maxLength: 200
        nullable: true
        description: 설치장소 구분
      managementAgency:
        type: string
        maxLength: 200
        nullable: true
        description: 관리기관명
      phoneNumber:
        type: string
        maxLength: 50
        nullable: true
        description: 관리기관 전화번호
    indexes:
      - fields: [city, district]
        type: composite
      - fields: [lat, lng]
        type: composite
    businessRules:
      - 좌표 범위: 위도 33-39, 경도 124-132 (한국 영역)
      - CSV 파일 인코딩: EUC-KR 또는 UTF-8 자동 감지

  clothes:
    name: 의류수거함
    table: Clothes
    source:
      dataNumber: "15139214"
      method: CSV
      provider: data.go.kr
      url: https://www.localdata.go.kr/data/15139214/standard.do
    fields:
      <<: *commonFields
      # Clothes-specific fields
      managementAgency:
        type: string
        maxLength: 200
        nullable: true
        description: 관리기관명
      phoneNumber:
        type: string
        maxLength: 50
        nullable: true
        description: 전화번호
      dataDate:
        type: string
        maxLength: 50
        nullable: true
        description: 데이터 기준일
      detailLocation:
        type: string
        maxLength: 500
        nullable: true
        description: 상세 위치
    indexes:
      - fields: [city, district]
        type: composite
      - fields: [lat, lng]
        type: composite
    businessRules:
      - 좌표 범위: 위도 33-39, 경도 124-132 (한국 영역)
      - CSV 파일 인코딩: EUC-KR 또는 UTF-8 자동 감지

  kiosk:
    name: 무인민원발급기
    table: Kiosk
    source:
      dataNumber: "15154774"
      method: API
      provider: data.go.kr
      url: https://www.data.go.kr/data/15154774/openapi.do
      endpoints:
        - name: installation_info
          url: https://apis.data.go.kr/1741000/kiosk_info/installation_info
        - name: certificate_info
          url: https://apis.data.go.kr/1741000/kiosk_info/certificate_info
    fields:
      <<: *commonFields
      # Kiosk-specific fields
      detailLocation:
        type: string
        maxLength: 500
        nullable: true
        description: 설치장소 상세위치
      operationAgency:
        type: string
        maxLength: 200
        nullable: true
        description: 관리기관명
      weekdayOperatingHours:
        type: string
        maxLength: 100
        nullable: true
        description: 평일 운영시간
      saturdayOperatingHours:
        type: string
        maxLength: 100
        nullable: true
        description: 토요일 운영시간
      holidayOperatingHours:
        type: string
        maxLength: 100
        nullable: true
        description: 공휴일 운영시간
      blindKeypad:
        type: boolean
        default: false
        description: 시각장애인용 키패드
      voiceGuide:
        type: boolean
        default: false
        description: 음성안내
      brailleOutput:
        type: boolean
        default: false
        description: 점자라벨 부착
      wheelchairAccessible:
        type: boolean
        default: false
        description: 휠체어 사용 가능
      mngNo:
        type: string
        maxLength: 50
        nullable: true
        description: 관리번호 (API 연결키)
      availableDocuments:
        type: json
        nullable: true
        description: 발급 가능 민원 목록
    indexes:
      - fields: [city, district]
        type: composite
      - fields: [lat, lng]
        type: composite
      - fields: [mngNo]
        type: single
    businessRules:
      - 2개 API 연동: installation_info (시설정보) + certificate_info (민원정보)
      - certificate_info.ISSUMCHN_NO == installation_info.MNG_NO로 매칭
      - 주소 정규화 후 지오코딩 (Kakao Maps API)

  parking:
    name: 공영주차장
    table: Parking
    source:
      dataNumber: "15050093"
      method: CSV
      provider: data.go.kr
      url: https://www.localdata.go.kr/data/15050093/standard.do
    fields:
      <<: *commonFields
      # Parking-specific fields
      parkingType:
        type: string
        maxLength: 50
        nullable: true
        description: 주차구분 (공영/민영)
      lotType:
        type: string
        maxLength: 50
        nullable: true
        description: 주차장유형 (노외/노상/부설)
      capacity:
        type: int
        default: 0
        description: 주차면수
      baseFee:
        type: int
        nullable: true
        description: 기본요금 (원)
      baseTime:
        type: int
        nullable: true
        description: 기본시간 (분)
      additionalFee:
        type: int
        nullable: true
        description: 추가요금 (원)
      additionalTime:
        type: int
        nullable: true
        description: 추가시간 (분)
      dailyMaxFee:
        type: int
        nullable: true
        description: 일최대요금 (원)
      monthlyFee:
        type: int
        nullable: true
        description: 월정기권요금 (원)
      operatingHours:
        type: string
        maxLength: 200
        nullable: true
        description: 운영시간
      phone:
        type: string
        maxLength: 50
        nullable: true
        description: 전화번호
      paymentMethod:
        type: string
        maxLength: 200
        nullable: true
        description: 결제방법
      remarks:
        type: text
        nullable: true
        description: 특기사항
      hasDisabledParking:
        type: boolean
        default: false
        description: 장애인전용주차구역 보유여부
    indexes:
      - fields: [city, district]
        type: composite
      - fields: [lat, lng]
        type: composite
    businessRules:
      - CSV 파일 인코딩: EUC-KR 또는 UTF-8 자동 감지
      - 좌표 범위: 위도 33-39, 경도 124-132 (한국 영역)

  aed:
    name: 자동심장충격기
    table: Aed
    source:
      dataNumber: "15000652"
      method: API
      format: XML
      provider: data.go.kr
      url: https://www.data.go.kr/data/15000652/openapi.do
      endpoint: http://apis.data.go.kr/B552657/AEDInfoInqireService/getEgytAedManageInfoInqire
    fields:
      <<: *commonFields
      # AED-specific fields
      buildPlace:
        type: string
        maxLength: 500
        nullable: true
        description: 설치 상세위치
      org:
        type: string
        maxLength: 200
        nullable: true
        description: 설치기관
      clerkTel:
        type: string
        maxLength: 50
        nullable: true
        description: 담당자 전화
      mfg:
        type: string
        maxLength: 100
        nullable: true
        description: 제조사
      model:
        type: string
        maxLength: 100
        nullable: true
        description: 모델명
      monSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 월요일 시작시간
      monEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 월요일 종료시간
      tueSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 화요일 시작시간
      tueEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 화요일 종료시간
      wedSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 수요일 시작시간
      wedEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 수요일 종료시간
      thuSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 목요일 시작시간
      thuEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 목요일 종료시간
      friSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 금요일 시작시간
      friEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 금요일 종료시간
      satSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 토요일 시작시간
      satEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 토요일 종료시간
      sunSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 일요일 시작시간
      sunEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 일요일 종료시간
      holSttTme:
        type: string
        maxLength: 4
        nullable: true
        description: 공휴일 시작시간
      holEndTme:
        type: string
        maxLength: 4
        nullable: true
        description: 공휴일 종료시간
    indexes:
      - fields: [city, district]
        type: composite
      - fields: [lat, lng]
        type: composite
    businessRules:
      - API 응답 형식: XML (fast-xml-parser 사용)
      - sourceId: serialSeq (시리얼번호, 고유)
      - 429 Rate Limit 재시도: 최대 5회, 지수 백오프 (10~160초)

  library:
    name: 공공도서관
    table: Library
    source:
      dataNumber: "15013093"
      method: CSV
      provider: data.go.kr
      url: https://www.localdata.go.kr/data/15013093/standard.do
    fields:
      <<: *commonFields
      # Library-specific fields
      libraryType:
        type: string
        maxLength: 50
        nullable: true
        description: 도서관 유형
      closedDays:
        type: string
        maxLength: 200
        nullable: true
        description: 휴관일
      weekdayOpenTime:
        type: string
        maxLength: 10
        nullable: true
        description: 평일 개관시간
      weekdayCloseTime:
        type: string
        maxLength: 10
        nullable: true
        description: 평일 폐관시간
      saturdayOpenTime:
        type: string
        maxLength: 10
        nullable: true
        description: 토요일 개관시간
      saturdayCloseTime:
        type: string
        maxLength: 10
        nullable: true
        description: 토요일 폐관시간
      holidayOpenTime:
        type: string
        maxLength: 10
        nullable: true
        description: 공휴일 개관시간
      holidayCloseTime:
        type: string
        maxLength: 10
        nullable: true
        description: 공휴일 폐관시간
      seatCount:
        type: int
        default: 0
        description: 열람좌석수
      bookCount:
        type: int
        default: 0
        description: 장서수 (도서)
      serialCount:
        type: int
        default: 0
        description: 자료수 (연속간행물)
      nonBookCount:
        type: int
        default: 0
        description: 자료수 (비도서)
      loanableBooks:
        type: int
        default: 0
        description: 대출가능 권수
      loanableDays:
        type: int
        default: 0
        description: 대출가능 일수
      phoneNumber:
        type: string
        maxLength: 50
        nullable: true
        description: 전화번호
      homepageUrl:
        type: string
        maxLength: 500
        nullable: true
        description: 홈페이지 URL
      operatingOrg:
        type: string
        maxLength: 200
        nullable: true
        description: 운영기관
    indexes:
      - fields: [city, district]
        type: composite
      - fields: [lat, lng]
        type: composite
    businessRules:
      - CSV 파일 인코딩: EUC-KR 또는 UTF-8 자동 감지
      - 좌표 범위: 위도 33-39, 경도 124-132 (한국 영역)

  category:
    name: 카테고리 마스터
    table: Category
    description: 시설 카테고리 분류 마스터 테이블
    fields:
      id:
        type: string
        primaryKey: true
        maxLength: 20
        description: 카테고리 ID
        enum: [toilet, wifi, clothes, kiosk, parking, aed, library]
      name:
        type: string
        maxLength: 50
        required: true
        description: 카테고리명
      icon:
        type: string
        maxLength: 10
        required: true
        description: 아이콘 식별자
      description:
        type: string
        maxLength: 200
        nullable: true
        description: 설명
      sortOrder:
        type: int
        default: 0
        description: 정렬 순서
      isActive:
        type: boolean
        default: true
        description: 활성화 여부

  region:
    name: 지역 마스터
    table: Region
    description: 시/도, 시/군/구 마스터 테이블
    fields:
      id:
        type: int
        primaryKey: true
        autoIncrement: true
        description: 고유 ID
      bjdCode:
        type: string
        maxLength: 5
        unique: true
        required: true
        description: 법정동 코드 (5자리)
      city:
        type: string
        maxLength: 50
        required: true
        description: 시/도
      district:
        type: string
        maxLength: 50
        required: true
        description: 시/군/구
      slug:
        type: string
        maxLength: 50
        required: true
        description: URL slug (로마자)
      lat:
        type: decimal
        precision: [10, 7]
        required: true
        description: 중심 위도
      lng:
        type: decimal
        precision: [10, 7]
        required: true
        description: 중심 경도
    indexes:
      - fields: [bjdCode]
        type: unique
      - fields: [city, district]
        type: unique
      - fields: [city, slug]
        type: unique

  searchLog:
    name: 검색 로그
    table: SearchLog
    description: 사용자 검색 이력 추적
    fields:
      id:
        type: int
        primaryKey: true
        autoIncrement: true
        description: 고유 ID
      sessionId:
        type: string
        maxLength: 32
        required: true
        description: 세션 ID
      keyword:
        type: string
        maxLength: 200
        nullable: true
        description: 검색 키워드
      category:
        type: string
        maxLength: 20
        nullable: true
        description: 카테고리 필터
      city:
        type: string
        maxLength: 50
        nullable: true
        description: 시/도 필터
      district:
        type: string
        maxLength: 50
        nullable: true
        description: 시/군/구 필터
      lat:
        type: decimal
        precision: [10, 7]
        nullable: true
        description: 검색 중심 위도
      lng:
        type: decimal
        precision: [10, 7]
        nullable: true
        description: 검색 중심 경도
      resultCount:
        type: int
        default: 0
        description: 검색 결과 수
      createdAt:
        type: datetime
        default: now()
        description: 검색 일시
    indexes:
      - fields: [createdAt]
        type: single
      - fields: [keyword]
        type: single

  syncHistory:
    name: 동기화 히스토리
    table: SyncHistory
    description: 데이터 동기화 이력 추적
    fields:
      id:
        type: int
        primaryKey: true
        autoIncrement: true
        description: 고유 ID
      category:
        type: string
        maxLength: 20
        required: true
        description: 카테고리 (toilet, wifi, clothes, kiosk, parking, aed, library, waste_schedule)
      status:
        type: enum
        values: [running, success, failed]
        required: true
        description: 동기화 상태
      totalRecords:
        type: int
        default: 0
        description: 전체 레코드 수
      newRecords:
        type: int
        default: 0
        description: 신규 레코드 수
      updatedRecords:
        type: int
        default: 0
        description: 업데이트 레코드 수
      errorMessage:
        type: text
        nullable: true
        description: 오류 메시지
      startedAt:
        type: datetime
        default: now()
        description: 시작 일시
      completedAt:
        type: datetime
        nullable: true
        description: 완료 일시

  wasteSchedule:
    name: 쓰레기 배출 일정
    table: WasteSchedule
    description: 생활쓰레기 배출 정보 (좌표 없음, 지도 마커 X)
    source:
      dataNumber: "15155080"
      method: API
      provider: data.go.kr
      url: https://www.data.go.kr/data/15155080/openapi.do
      endpoint: https://apis.data.go.kr/1741000/household_waste_info/info
    fields:
      id:
        type: int
        primaryKey: true
        autoIncrement: true
        description: 고유 ID
      city:
        type: string
        maxLength: 50
        required: true
        description: 시/도명
      district:
        type: string
        maxLength: 50
        required: true
        description: 시/군/구명
      targetRegion:
        type: text
        nullable: true
        description: 관리구역 대상지역명
      emissionPlace:
        type: string
        maxLength: 100
        nullable: true
        description: 배출장소
      details:
        type: json
        nullable: true
        description: 상세 정보 (배출요일, 시간, 방법 등)
      sourceId:
        type: string
        maxLength: 100
        required: true
        description: 원본 데이터 ID
      sourceUrl:
        type: string
        maxLength: 500
        nullable: true
        description: 데이터 출처 URL
      createdAt:
        type: datetime
        default: now()
        description: 생성일시
      updatedAt:
        type: datetime
        autoUpdate: true
        description: 수정일시
      syncedAt:
        type: datetime
        default: now()
        description: 동기화 일시
    indexes:
      - fields: [city, district, sourceId]
        type: unique
      - fields: [city, district]
        type: composite
    businessRules:
      - 좌표 없음: 지도 마커 표시 불가
      - 4개 유형 정보 포함: 생활쓰레기, 음식물쓰레기, 재활용, 대형폐기물
      - details JSON 구조: livingWaste, foodWaste, recyclable, bulkWaste

relationships:
  - from: Toilet
    to: Region
    type: manyToOne
    via: [city, district]
  - from: Wifi
    to: Region
    type: manyToOne
    via: [city, district]
  - from: Clothes
    to: Region
    type: manyToOne
    via: [city, district]
  - from: Kiosk
    to: Region
    type: manyToOne
    via: [city, district]
  - from: Parking
    to: Region
    type: manyToOne
    via: [city, district]
  - from: Aed
    to: Region
    type: manyToOne
    via: [city, district]
  - from: Library
    to: Region
    type: manyToOne
    via: [city, district]
  - from: WasteSchedule
    to: Region
    type: manyToOne
    via: [city, district]
